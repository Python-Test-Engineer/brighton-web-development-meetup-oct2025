<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>ChatGPT Clone</title>
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet">
   <style>
      * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
      }

      body {
         font-family: 'Raleway', sans-serif;
         font-size: 16px;
         height: 100vh;
         display: flex;
         flex-direction: column;
         background: #343541;
         color: #fff;
      }

      .header {
         padding: 15px 20px;
         background: #202123;
         border-bottom: 1px solid #4d4d4f;
         display: flex;
         align-items: center;
         gap: 15px;
      }

      .header h1 {
         font-size: 18px;
         font-weight: 600;
      }

      .api-key-input {
         flex: 1;
         max-width: 400px;
         padding: 8px 12px;
         background: #40414f;
         border: 1px solid #565869;
         border-radius: 5px;
         color: #fff;
         font-size: 14px;
      }

      .chat-container {
         flex: 1;
         overflow-y: auto;
         padding: 20px;
         display: flex;
         flex-direction: column;
         gap: 20px;
      }

      .message {
         display: flex;
         gap: 15px;
         padding: 20px;
         max-width: 800px;
         width: 100%;
         margin: 0 auto;
      }

      .message.user {
         background: #343541;
      }

      .message.assistant {
         background: #444654;
      }

      .message.error {
         background: #5c1a1a;
      }

      .avatar {
         width: 40px;
         height: 40px;
         border-radius: 5px;
         display: flex;
         align-items: center;
         justify-content: center;
         font-weight: bold;
         flex-shrink: 0;
      }

      .user .avatar {
         background: #5436da;
      }

      .assistant .avatar {
         background: #19c37d;
      }

      .error .avatar {
         background: #ef4444;
      }

      .message-content {
         flex: 1;
         line-height: 1.6;
      }

      .input-container {
         padding: 20px;
         background: #343541;
         border-top: 1px solid #4d4d4f;
      }

      .input-wrapper {
         max-width: 800px;
         margin: 0 auto;
         display: flex;
         gap: 10px;
         align-items: center;
         background: #40414f;
         border-radius: 8px;
         padding: 12px;
         border: 1px solid #565869;
      }

      .prompt-input {
         flex: 1;
         background: transparent;
         border: none;
         color: #fff;
         font-size: 16px;
         outline: none;
      }

      .send-btn {
         padding: 8px 20px;
         background: #19c37d;
         color: #fff;
         border: none;
         border-radius: 5px;
         cursor: pointer;
         font-weight: 600;
         transition: background 0.2s;
      }

      .send-btn:hover:not(:disabled) {
         background: #1a9f6a;
      }

      .send-btn:disabled {
         background: #40414f;
         cursor: not-allowed;
         opacity: 0.5;
      }

      .loading {
         display: inline-block;
         width: 8px;
         height: 8px;
         border-radius: 50%;
         background: #19c37d;
         animation: pulse 1.5s ease-in-out infinite;
      }

      @keyframes pulse {

         0%,
         100% {
            opacity: 0.3;
         }

         50% {
            opacity: 1;
         }
      }

      code {
         background: #2d2d2d;
         padding: 2px 6px;
         border-radius: 3px;
         font-family: 'Fira Code', monospace;
         font-size: 14px;
      }

      pre {
         background: #2d2d2d;
         padding: 15px;
         border-radius: 5px;
         overflow-x: auto;
         margin: 10px 0;
      }

      pre code {
         background: transparent;
         padding: 0;
      }
   </style>
</head>

<body>
   <div class="header">
      <h1>ChatGPT Clone</h1>
      <input type="password" class="api-key-input" id="apiKey" placeholder="Enter your OpenAI API key">
   </div>

   <div class="chat-container" id="chatContainer"></div>

   <div class="input-container">
      <div class="input-wrapper">
         <input type="text" class="prompt-input" id="promptInput" placeholder="Send a message..."
            onkeypress="if(event.key==='Enter') sendMessage()">
         <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
      </div>
   </div>

   <script>
      let conversationHistory = [];

      function get_weather() {
         return "The current weather is 25Â°C, sunny with a light breeze.";
      }

      function addMessage(role, content) {
         const chatContainer = document.getElementById('chatContainer');
         const messageDiv = document.createElement('div');
         messageDiv.className = `message ${role}`;

         const avatar = document.createElement('div');
         avatar.className = 'avatar';
         avatar.textContent = role === 'user' ? 'U' : role === 'assistant' ? 'A' : '!';

         const contentDiv = document.createElement('div');
         contentDiv.className = 'message-content';
         contentDiv.innerHTML = content;

         messageDiv.appendChild(avatar);
         messageDiv.appendChild(contentDiv);
         chatContainer.appendChild(messageDiv);

         chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      async function sendMessage() {
         const apiKey = document.getElementById('apiKey').value;
         const promptInput = document.getElementById('promptInput');
         const prompt = promptInput.value.trim();
         const sendBtn = document.getElementById('sendBtn');

         if (!apiKey) {
            addMessage('error', 'Please enter your API key in the header');
            return;
         }

         if (!prompt) return;

         // Add user message
         addMessage('user', prompt);
         conversationHistory.push({ role: 'user', content: prompt });

         // Clear input and disable button
         promptInput.value = '';
         sendBtn.disabled = true;

         // Add loading indicator
         addMessage('assistant', '<span class="loading"></span> Thinking...');
         const messages = document.querySelectorAll('.message');
         const loadingMessage = messages[messages.length - 1];

         const systemPrompt = `
         You are a helpful assistant. You always answer in a concise manner. 

         You never refuse to answer but do not make things up - just say 'I don't know'. You always try to help the user as much as possible. 

         Convert markdown to HTML when needed so that ouput is properly formatted.Ensure there is a new line after each sentence.

Brighton Web Development Meet Up is taking place on October 29th.
The venue is the Skiff.
The event starts at 6:30 PM and finishes at 9:00 PM.
The Speaker is Craig West and the topic is 'AI Agents and Evals for all languages'
Brighton Web Development Meet Up is part of Silicon Brighton.
The organiser is Gavin.
Similar meet ups are WOrdUp Brighton, BrightonPy, PHP Sussex and many more.
Details at siliconbrighton.com.
It has been running since 1865 (3rd October 1865).

         `;
         try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${apiKey}`
               },
               body: JSON.stringify({
                  model: 'gpt-4o-mini',
                  messages: [
                     { role: 'system', content: systemPrompt },
                     ...conversationHistory
                  ],
                  max_tokens: 1024
               })
            });

            const data = await response.json();

            // Remove loading message
            loadingMessage.remove();

            if (data.error) {
               addMessage('error', `Error: ${data.error.message}`);
            } else {
               let msg = data.choices[0].message.content;
               let output = msg;

               // Handle tool call
               if (msg === "tool:get_weather") {
                  output = get_weather();
               }

               addMessage('assistant', output);
               conversationHistory.push({ role: 'assistant', content: output });
            }
         } catch (error) {
            loadingMessage.remove();
            addMessage('error', `Error: ${error.message}`);
         } finally {
            sendBtn.disabled = false;
            promptInput.focus();
         }
      }

      // Focus input on load
      document.getElementById('promptInput').focus();
   </script>
</body>

</html>