<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>OpenAI API in Browser</title>
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet">
   <style>
      * {
         font-family: 'Raleway', sans-serif;
         font-size: 20px;
      }

      body {
         font-family: 'Raleway', sans-serif;
         max-width: 800px;
         margin: 50px auto;
         font-size: 20px;

      }

      input {
         width: 100%;
         padding: 10px;
         margin: 10px 0;
      }

      button {
         padding: 10px 20px;
         background: #007bff;
         color: white;
         border: none;
         cursor: pointer;
      }

      button:hover {
         background: #0056b3;
      }

      #result {
         margin-top: 20px;
         padding: 15px;
         background: #bcbeb6;
         border-radius: 5px;
         border: 4px solid #6c757d;
         min-height: 100px;
      }
   </style>
</head>

<body>
   <h1>OpenAI API in Browser</h1>
   <input type="password" id="apiKey" placeholder="Enter your OpenAI API key">
   <input type="text" id="prompt" placeholder="Enter your prompt" value="Say hello!">

   <button id="sendBtn" type="submit">Send Request</button>

   <br>
   <div id="result"></div>

   <script>

      function get_weather() {
         // Simulate fetching weather data
         return "The current weather is 25Â°C, sunny with a light breeze.";
      }

      /**
       * Returns a string describing the sum of two numbers.
       * @param {number} a The first number.
       * @param {number} b The second number.
       * @returns {string} A string describing the sum of a and b.
       */
      function get_sum(a, b) {
         return `The sum of ${a} and ${b} is ${a + b}.`;
      }


      document.getElementById('sendBtn').addEventListener('click', async () => {
         const apiKey = document.getElementById('apiKey').value;
         const prompt = document.getElementById('prompt').value;
         const resultDiv = document.getElementById('result');


         if (!apiKey) {
            resultDiv.innerHTML = '<p style="color: red;">Please enter your API key</p>';
            return;
         }

         resultDiv.innerHTML = '<p>Loading...</p>';
         system_prompt = `
         You are a helpful assistant. You always answer in a concise manner. 

         You never refuse to answer but do not make things up - just say 'I don't know'. You always try to help the user as much as possible. 

         Convert markdown to HTML when needed so that ouput is properly formatted.Ensure there is a new line after each sentence.

Brighton Web Development Meet Up is taking place on October 29th.
The venue is the Skiff.
The event starts at 6:30 PM and finishes at 9:00 PM.
The Speaker is Craig West and the topic is 'AI Agents and Evals for all languages'
Brighton Web Development Meet Up is part of Silicon Brighton.
The current organiser is Gavin and it has been running since 1865 (3rd October 1865) the first meetup being organised by Louise.
Similar meet ups are WordUp Brighton, BrightonPy, PHP Sussex and many more.
Details at siliconbrighton.com.


         `;
         // const apiKey = "sk-proj-vIt-"
         try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${apiKey}`
               },
               body: JSON.stringify({
                  model: 'gpt-4o-mini',
                  messages: [{ role: 'system', content: system_prompt }, { role: 'user', content: prompt }],
                  max_tokens: 1024
               })
            });

            const data = await response.json();

            const msg = data.choices[0].message.content;
            let output = "";
            if (msg == "tool:get_weather") {
               alert(msg)
               output += get_weather();
            }

            if (data.error) {
               resultDiv.innerHTML = `<p style="color: red;">Error: ${data.error.message}</p>`;
            } else {
               resultDiv.innerHTML = `<p><strong>Response:</strong></p><p>${output + '<br>' + data.choices[0].message.content}</p>`;
            }
         } catch (error) {
            resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
         }
      });
   </script>
</body>

</html>